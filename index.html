<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PlainID Platform - Native Policy Workflow</title>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            margin: 0;
            padding: 0;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Oxygen', 'Ubuntu', 'Cantarell', sans-serif;
        }
        .sidebar {
            background: #0a1628;
        }
        .nav-item {
            color: #8b93a7;
            transition: all 0.2s;
        }
        .nav-item:hover {
            color: #ffffff;
            background: #1a2d4a;
        }
        .nav-item.active {
            color: #60a5fa;
            background: #1a2d4a;
        }
        .card-hover {
            transition: all 0.2s;
        }
        .card-hover:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
        }
        .policy-card {
            background: #f8fafc;
            border: 1px solid #e2e8f0;
            transition: all 0.2s;
        }
        .policy-card:hover {
            background: #eff6ff;
            border-color: #60a5fa;
        }
        .drawer-overlay {
            position: fixed;
            inset: 0;
            background: rgba(0, 0, 0, 0.5);
            z-index: 50;
            transition: opacity 0.3s;
        }
        .drawer {
            position: fixed;
            right: 0;
            top: 0;
            bottom: 0;
            width: 50%;
            background: white;
            box-shadow: -4px 0 20px rgba(0, 0, 0, 0.15);
            transform: translateX(100%);
            transition: transform 0.3s ease-in-out;
            z-index: 51;
            overflow-y: auto;
        }
        .drawer.open {
            transform: translateX(0);
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState } = React;

        const PlainIDPlatform = () => {
            const [currentView, setCurrentView] = useState('orchestration');
            const [currentStep, setCurrentStep] = useState(1);
            const [selectedPOP, setSelectedPOP] = useState(null);
            const [selectedPolicy, setSelectedPolicy] = useState(null);
            const [showPolicyDrawer, setShowPolicyDrawer] = useState(false);
            const [activeTab, setActiveTab] = useState('details');
            const [showModal, setShowModal] = useState(false);
            const [modalStep, setModalStep] = useState(1);
            const [policyFormData, setPolicyFormData] = useState({
                vendorPolicyKind: '',
                vendorPolicyName: '',
                vendorPolicyId: '',
                vendorPolicyOrder: '1'
            });
            const [policyCode, setPolicyCode] = useState('');
            const [showSuccess, setShowSuccess] = useState(false);
            const [expandedSections, setExpandedSections] = useState({
                general: true,
                input: true,
                policyRule: true,
                action: true,
                assets: true
            });

            // Data
            const pops = [
                {
                    id: 'databricks',
                    name: 'Databricks',
                    icon: 'üìä',
                    color: 'bg-orange-50 border-orange-200',
                    vendorPolicies: [
                        { id: 'mask_salary', name: 'mask_salary' },
                        { id: 'row_filter', name: 'row_filter_by_department' }
                    ]
                },
                {
                    id: 'snowflake',
                    name: 'Snowflake',
                    icon: '‚ùÑÔ∏è',
                    color: 'bg-blue-50 border-blue-200',
                    vendorPolicies: [
                        { id: 'finance_analyst', name: 'FINANCE_DATA_ANALYST_POLICY' },
                        { id: 'finance_masking', name: 'Finance_Masking_Policy' },
                        { id: 'mask_transaction', name: 'Mask_TransactionID_For_private_accounts' },
                        { id: 'mask_val_account', name: 'mask_val_based_on_account_type' },
                        { id: 'pii_masking', name: 'PII_MASKING_POLICY_PRIVATE_CLIENTS' },
                        { id: 'support_mask', name: 'SUPPORT_MASK_POLICY' }
                    ]
                }
            ];

            const policies = [
                {
                    id: 'support_mask',
                    name: 'SUPPORT_MASK_POLICY',
                    database: 'PRODUCT_DEMO',
                    schema: 'SCHEMA1',
                    owner: 'ACCOUNTADMIN',
                    nativeCode: `CREATE OR REPLACE MASKING POLICY PRODUCT_DEMO.SCHEMA1.SUPPORT_MASK_POLICY AS (VAL VARCHAR) RETURNS VARCHAR ->
    CASE
        -- Managers see partial values for Tier
        WHEN CURRENT_ROLE() = 'ROLE_MANAGER'
            THEN LEFT(val, 1) || '***'
        ELSE '***MASKED***'
    END`,
                    columns: `ALTER TABLE PRODUCT_DEMO.SCHEMA1.SUPPORT_TABLE MODIFY COLUMN TIER SET MASKING POLICY PRODUCT_DEMO.SCHEMA1.SUPPORT_MASK_POLICY`,
                    auditEvents: [
                        { id: 'd07d492b-f374-4e29-b4', date: '10/7/2025 9:50:56 PM', user: 'POP1TLVCGB68YT', operation: 'Create' }
                    ]
                },
                {
                    id: 'finance_masking',
                    name: 'Finance_Masking_Policy',
                    database: 'product_demo',
                    schema: 'schema1',
                    owner: 'PRODUCT_DEMO',
                    nativeCode: `CREATE OR REPLACE MASKING POLICY product_demo.schema1.tag_based_masking AS
    (val STRING) RETURNS STRING ->
    CASE
        WHEN SYSTEM$GET_TAG_ON_CURRENT_COLUMN('product_demo.schema1.data_classification') = 'FINANCIAL'
            AND CURRENT_ROLE() = 'ROLE_FINANCE'
            THEN val
        ELSE '***MASKED***'
    END;`
                }
            ];

            // Sidebar Component
            const Sidebar = () => (
                <div className="sidebar w-64 h-screen fixed left-0 top-0 flex flex-col">
                    <div className="p-4 border-b border-gray-700">
                        <div className="flex items-center gap-2 mb-4">
                            <div className="w-8 h-8 bg-blue-500 rounded flex items-center justify-center text-white font-bold">
                                P
                            </div>
                            <div className="text-white text-sm font-semibold">The PlainID Platform</div>
                        </div>
                        <div className="bg-gray-800 rounded px-3 py-2 text-sm text-gray-300">
                            <div className="flex items-center justify-between">
                                <span>Policy 360 Native Policy</span>
                                <span>‚åÑ</span>
                            </div>
                        </div>
                    </div>

                    <nav className="flex-1 p-2">
                        <div className="space-y-1">
                            <div className="nav-item px-3 py-2 rounded text-sm cursor-pointer flex items-center gap-2">
                                <span>üìä</span> Environment Dashboard
                            </div>
                            <div className="nav-item px-3 py-2 rounded text-sm cursor-pointer flex items-center gap-2">
                                <span>üìã</span> Administration Audit
                            </div>
                            <div className="nav-item px-3 py-2 rounded text-sm cursor-pointer flex items-center gap-2">
                                <span>üîç</span> Authorization Audit
                            </div>
                            <div className="nav-item px-3 py-2 rounded text-sm cursor-pointer flex items-center gap-2">
                                <span>‚öôÔ∏è</span> Environment Settings
                            </div>
                        </div>

                        <div className="mt-6">
                            <div className="px-3 py-2 text-xs text-gray-500 uppercase font-semibold flex items-center justify-between">
                                Workspaces
                                <div className="flex gap-2">
                                    <span className="cursor-pointer">üîç</span>
                                    <span className="cursor-pointer">+</span>
                                </div>
                            </div>
                            <div className="space-y-1 mt-2">
                                <div className="px-3 py-1 text-sm text-gray-400 cursor-pointer flex items-center gap-2">
                                    <span>üë•</span> IDENTITY (2)
                                </div>
                                <div className="pl-6 space-y-1">
                                    <div className="nav-item px-3 py-1 rounded text-xs cursor-pointer">Databricks Identity WS</div>
                                    <div className="nav-item px-3 py-1 rounded text-xs cursor-pointer">Snowflake Identity WS</div>
                                </div>
                                <div className="px-3 py-1 text-sm text-gray-400 cursor-pointer flex items-center gap-2 mt-2">
                                    <span>üîê</span> AUTHORIZATION (2)
                                </div>
                                <div className="pl-6 space-y-1">
                                    <div className="nav-item px-3 py-1 rounded text-xs cursor-pointer">Databricks Auth WS</div>
                                    <div 
                                        className={`nav-item ${currentView === 'policy-full-view' ? 'active' : ''} px-3 py-1 rounded text-xs cursor-pointer`}
                                        onClick={() => {
                                            if (selectedPolicy) {
                                                setCurrentView('policy-full-view');
                                                setCurrentStep(3);
                                                setActiveTab('details');
                                            }
                                        }}
                                    >
                                        Snowflake Auth WS
                                    </div>
                                </div>
                                <div className="px-3 py-1 text-sm text-gray-400 cursor-pointer flex items-center gap-2 mt-2">
                                    <span>üîó</span> ORCHESTRATION (1)
                                </div>
                                <div className="pl-6">
                                    <div className={`nav-item ${currentView === 'orchestration' || currentView === 'pop-details' ? 'active' : ''} px-3 py-1 rounded text-xs cursor-pointer`}>Orchestration WS</div>
                                </div>
                            </div>
                        </div>
                    </nav>

                    <div className="p-4 border-t border-gray-700">
                        <div className="text-xs text-gray-500">SE Walkthrough Only</div>
                    </div>
                </div>
            );

            // Navigation Bar
            const NavigationBar = () => {
                const steps = [
                    { num: 1, label: 'Select POP' },
                    { num: 2, label: 'View Policies' },
                    { num: 3, label: 'View Details' },
                    { num: 4, label: 'Native Code' },
                    { num: 5, label: 'Create Policy' },
                    { num: 6, label: 'Write Code' },
                    { num: 7, label: 'Deploy' }
                ];

                return (
                    <div className="fixed bottom-0 left-64 right-0 bg-white border-t shadow-lg z-40">
                        <div className="px-8 py-4">
                            <div className="flex items-center justify-between">
                                <div className="flex items-center gap-2">
                                    {steps.map((step, idx) => (
                                        <React.Fragment key={step.num}>
                                            <div className={`flex items-center gap-2 ${
                                                currentStep >= step.num ? 'text-blue-600' : 'text-gray-400'
                                            }`}>
                                                <div className={`w-8 h-8 rounded-full flex items-center justify-center font-bold text-xs ${
                                                    currentStep === step.num 
                                                        ? 'bg-blue-600 text-white ring-4 ring-blue-100' 
                                                        : currentStep > step.num
                                                        ? 'bg-blue-500 text-white'
                                                        : 'bg-gray-200 text-gray-500'
                                                }`}>
                                                    {currentStep > step.num ? '‚úì' : step.num}
                                                </div>
                                                <span className="text-xs font-medium hidden lg:inline">{step.label}</span>
                                            </div>
                                            {idx < steps.length - 1 && (
                                                <div className={`w-12 h-0.5 ${
                                                    currentStep > step.num ? 'bg-blue-500' : 'bg-gray-200'
                                                }`}></div>
                                            )}
                                        </React.Fragment>
                                    ))}
                                </div>
                                
                                <div className="flex gap-2">
                                    {currentStep > 1 && (
                                        <button 
                                            onClick={() => {
                                                if (currentStep === 2) {
                                                    setCurrentView('orchestration');
                                                    setCurrentStep(1);
                                                } else if (currentStep === 3) {
                                                    setCurrentView('pop-details');
                                                    setCurrentStep(2);
                                                } else if (currentStep === 4) {
                                                    setActiveTab('details');
                                                    setCurrentStep(3);
                                                }
                                            }}
                                            className="px-4 py-2 border border-gray-300 rounded text-sm hover:bg-gray-50"
                                        >
                                            ‚Üê Previous
                                        </button>
                                    )}
                                    {currentStep < steps.length && !showModal && (
                                        <button 
                                            onClick={() => {
                                                if (currentStep === 1 && !selectedPOP) {
                                                    alert('Please select a Policy Orchestration Point');
                                                } else if (currentStep === 2 && !selectedPolicy) {
                                                    alert('Please select a policy');
                                                } else if (currentStep === 2 && selectedPolicy) {
                                                    setCurrentView('policy-full-view');
                                                    setCurrentStep(3);
                                                    setActiveTab('details');
                                                } else if (currentStep === 3) {
                                                    setActiveTab('native');
                                                    setCurrentStep(4);
                                                } else if (currentStep === 4) {
                                                    setCurrentStep(5);
                                                } else if (currentStep === 5) {
                                                    setShowModal(true);
                                                    setModalStep(1);
                                                    setCurrentStep(5);
                                                }
                                            }}
                                            className="px-4 py-2 bg-blue-600 text-white rounded text-sm hover:bg-blue-700"
                                        >
                                            Next ‚Üí
                                        </button>
                                    )}
                                </div>
                            </div>
                        </div>
                    </div>
                );
            };

            // Orchestration View
            const OrchestrationView = () => (
                <div className="ml-64 p-8 pb-32">
                    <div className="mb-6">
                        <div className="flex items-center justify-between mb-2">
                            <h1 className="text-2xl font-semibold text-gray-800">Policy Orchestration Points</h1>
                        </div>
                        <div className="flex items-center gap-2">
                            <button className="p-2 hover:bg-gray-100 rounded">
                                üîç
                            </button>
                        </div>
                    </div>

                    <div className="grid grid-cols-2 gap-6">
                        {pops.map(pop => (
                            <div
                                key={pop.id}
                                onClick={() => {
                                    setSelectedPOP(pop);
                                    setCurrentView('pop-details');
                                    setCurrentStep(2);
                                }}
                                className={`${pop.color} border-2 rounded-lg p-6 cursor-pointer card-hover ${
                                    selectedPOP?.id === pop.id ? 'ring-2 ring-blue-400' : ''
                                }`}
                            >
                                <div className="flex items-start justify-between mb-4">
                                    <div className="flex items-center gap-3">
                                        <div className="text-3xl">{pop.icon}</div>
                                        <h3 className="text-xl font-semibold text-gray-800">{pop.name}</h3>
                                    </div>
                                    <button className="p-1 hover:bg-white rounded">
                                        <svg className="w-5 h-5 text-gray-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 5v.01M12 12v.01M12 19v.01M12 6a1 1 0 110-2 1 1 0 010 2zm0 7a1 1 0 110-2 1 1 0 010 2zm0 7a1 1 0 110-2 1 1 0 010 2z" />
                                        </svg>
                                    </button>
                                </div>
                                <button className="w-full py-2 bg-white border border-gray-300 rounded text-sm font-medium hover:bg-gray-50">
                                    Learn
                                </button>
                            </div>
                        ))}

                        <div className="border-2 border-dashed border-gray-300 rounded-lg p-6 flex flex-col items-center justify-center cursor-pointer hover:border-blue-400 hover:bg-blue-50">
                            <div className="text-4xl text-gray-400 mb-2">+</div>
                            <div className="text-sm font-medium text-gray-600">Add Policy Orchestration Point</div>
                        </div>
                    </div>
                </div>
            );

            // POP Details View
            const POPDetailsView = () => {
                if (!selectedPOP) return null;

                return (
                    <div className="ml-64 flex h-screen pb-32">
                        <div className="w-96 border-r bg-white p-6">
                            <button 
                                onClick={() => {
                                    setCurrentView('orchestration');
                                    setCurrentStep(1);
                                }}
                                className="text-sm text-blue-600 hover:text-blue-800 mb-6"
                            >
                                ‚Üê Policy 360 Native Policy / Orchestration WS
                            </button>

                            <h2 className="text-xl font-semibold mb-6">Policy Orchestration Points</h2>

                            <div className="space-y-3">
                                {pops.map(pop => (
                                    <div
                                        key={pop.id}
                                        onClick={() => setSelectedPOP(pop)}
                                        className={`${pop.color} border-2 rounded-lg p-4 cursor-pointer ${
                                            selectedPOP.id === pop.id ? 'ring-2 ring-blue-400' : ''
                                        }`}
                                    >
                                        <div className="flex items-center gap-3">
                                            <div className="text-2xl">{pop.icon}</div>
                                            <div className="font-semibold text-gray-800">{pop.name}</div>
                                        </div>
                                    </div>
                                ))}
                            </div>
                        </div>

                        <div className="flex-1 p-8 bg-gray-50 overflow-auto">
                            <div className="mb-6">
                                <div className="flex items-center gap-3 mb-2">
                                    <div className="text-3xl">{selectedPOP.icon}</div>
                                    <div>
                                        <h1 className="text-2xl font-semibold text-gray-800">{selectedPOP.name}</h1>
                                        <p className="text-sm text-gray-500">Discovery Info</p>
                                    </div>
                                </div>
                            </div>

                            <div className="bg-white rounded-lg shadow">
                                <div className="border-b flex">
                                    <button className="px-6 py-3 border-b-2 border-blue-500 text-blue-600 font-medium text-sm">
                                        Vendor Policies ({selectedPOP.vendorPolicies.length})
                                    </button>
                                    <button className="px-6 py-3 text-gray-600 font-medium text-sm">
                                        Objects (8)
                                    </button>
                                </div>

                                <div className="p-6">
                                    <div className="flex gap-3 mb-6">
                                        <input 
                                            type="text" 
                                            placeholder="Search by Keywords"
                                            className="flex-1 px-4 py-2 border border-gray-300 rounded text-sm"
                                        />
                                        <button className="px-4 py-2 border border-gray-300 rounded text-sm">üîç</button>
                                        <button className="px-4 py-2 border border-gray-300 rounded text-sm">üìã</button>
                                        <button className="px-4 py-2 bg-blue-600 text-white rounded text-sm">Discover now</button>
                                    </div>

                                    <div className="text-right text-sm text-gray-500 mb-4">
                                        1 - 6 of 6
                                    </div>

                                    <div className="grid grid-cols-2 gap-4">
                                        {selectedPOP.vendorPolicies.map(policy => {
                                            const fullPolicy = policies.find(p => p.id === policy.id);
                                            return (
                                                <div
                                                    key={policy.id}
                                                    onClick={() => {
                                                        if (fullPolicy) {
                                                            setSelectedPolicy(fullPolicy);
                                                            setShowPolicyDrawer(true);
                                                            // Drawer stays at step 2
                                                        }
                                                    }}
                                                    className="policy-card p-4 rounded cursor-pointer"
                                                >
                                                    <div className="font-medium text-gray-800 text-sm">{policy.name}</div>
                                                </div>
                                            );
                                        })}
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                );
            };

            // Policy Details Drawer
            const PolicyDetailsView = () => {
                if (!selectedPolicy || !showPolicyDrawer) return null;

                const toggleSection = (section) => {
                    setExpandedSections({...expandedSections, [section]: !expandedSections[section]});
                };

                const CollapsibleSection = ({ title, isExpanded, onToggle, children }) => (
                    <div className="border-b">
                        <button 
                            onClick={onToggle}
                            className="w-full flex items-center justify-between p-4 hover:bg-gray-50"
                        >
                            <h3 className="font-semibold text-gray-800">{title}</h3>
                            <span className="text-gray-500">{isExpanded ? '‚åÑ' : '‚Ä∫'}</span>
                        </button>
                        {isExpanded && (
                            <div className="p-4 bg-gray-50">
                                {children}
                            </div>
                        )}
                    </div>
                );

                return (
                    <>
                        {/* Backdrop overlay */}
                        <div 
                            className="drawer-overlay"
                            onClick={() => setShowPolicyDrawer(false)}
                        ></div>

                        {/* Sliding drawer */}
                        <div className={`drawer ${showPolicyDrawer ? 'open' : ''}`}>
                            {showSuccess && (
                                <div className="fixed top-4 right-4 bg-green-500 text-white px-6 py-3 rounded shadow-lg flex items-center gap-2 z-50">
                                    <span>‚úì</span>
                                    Success - "Snowflake" updated successfully
                                </div>
                            )}

                            {/* Header with close button */}
                            <div className="sticky top-0 bg-white border-b z-10 p-6">
                                <div className="flex items-center justify-between mb-4">
                                    <h1 className="text-2xl font-semibold text-gray-800">{selectedPolicy.name}</h1>
                                    <button 
                                        onClick={() => setShowPolicyDrawer(false)}
                                        className="text-2xl text-gray-400 hover:text-gray-600"
                                    >
                                        √ó
                                    </button>
                                </div>
                                
                                <div className="flex items-center gap-3">
                                    <span className="px-3 py-1 bg-green-100 text-green-700 rounded-full text-sm font-medium">
                                        ‚úì Allow
                                    </span>
                                    <label className="relative inline-flex items-center cursor-pointer">
                                        <input type="checkbox" className="sr-only peer" defaultChecked />
                                        <div className="w-11 h-6 bg-gray-200 peer-focus:ring-4 peer-focus:ring-blue-300 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-blue-600"></div>
                                        <span className="ml-3 text-sm font-medium text-gray-700">Active</span>
                                    </label>
                                </div>
                            </div>

                            {/* Content with collapsible sections */}
                            <div className="bg-white pb-20">
                                {/* General Section */}
                                <CollapsibleSection 
                                    title={`General - ${selectedPolicy.name}`}
                                    isExpanded={expandedSections.general}
                                    onToggle={() => toggleSection('general')}
                                >
                                    <div className="space-y-3 font-mono text-sm">
                                        <div className="flex">
                                            <span className="text-gray-600 w-48">"vendorPolicyID":</span>
                                            <span className="text-red-700">"{selectedPolicy.database}.{selectedPolicy.schema}.{selectedPolicy.name}"</span>
                                        </div>
                                        <div className="flex">
                                            <span className="text-gray-600 w-48">"vendorPolicyName":</span>
                                            <span className="text-red-700">"{selectedPolicy.name}"</span>
                                        </div>
                                        <div className="flex">
                                            <span className="text-gray-600 w-48">"vendorPolicyKind":</span>
                                            <span className="text-red-700">"MASKING_POLICY"</span>
                                        </div>
                                        <div className="flex">
                                            <span className="text-gray-600 w-48">"database":</span>
                                            <span className="text-red-700">"{selectedPolicy.database}"</span>
                                        </div>
                                        <div className="flex">
                                            <span className="text-gray-600 w-48">"schema":</span>
                                            <span className="text-red-700">"{selectedPolicy.schema}"</span>
                                        </div>
                                        <div className="flex">
                                            <span className="text-gray-600 w-48">"owner":</span>
                                            <span className="text-red-700">"{selectedPolicy.owner}"</span>
                                        </div>
                                        <div className="flex">
                                            <span className="text-gray-600 w-48">"options":</span>
                                            <span className="text-red-700">""</span>
                                        </div>
                                        <div className="flex">
                                            <span className="text-gray-600 w-48">"comment":</span>
                                            <span className="text-red-700">""</span>
                                        </div>
                                    </div>
                                </CollapsibleSection>

                                {/* Input Section */}
                                <CollapsibleSection 
                                    title={`Input - ${selectedPolicy.name}`}
                                    isExpanded={expandedSections.input}
                                    onToggle={() => toggleSection('input')}
                                >
                                    <div className="font-mono text-sm">
                                        <span className="text-blue-600">VAL</span> <span className="text-green-600">VARCHAR</span>
                                    </div>
                                </CollapsibleSection>

                                {/* Policy Rule Section */}
                                <CollapsibleSection 
                                    title={`Policy Rule - ${selectedPolicy.name}`}
                                    isExpanded={expandedSections.policyRule}
                                    onToggle={() => toggleSection('policyRule')}
                                >
                                    <pre className="font-mono text-sm text-gray-800 whitespace-pre-wrap">
                                        <span className="text-purple-600">CASE</span>
                                        {'\n    '}-- Managers see partial values for Tier
                                        {'\n    '}<span className="text-purple-600">WHEN</span> <span className="text-blue-600">CURRENT_ROLE</span>() = <span className="text-red-600">'ROLE_MANAGER'</span>
                                        {'\n        '}<span className="text-purple-600">THEN</span> <span className="text-blue-600">LEFT</span>(val, 1) || <span className="text-red-600">'***'</span>
                                        {'\n        '}<span className="text-purple-600">ELSE</span> <span className="text-red-600">'***MASKED***'</span>
                                        {'\n'}<span className="text-purple-600">END</span>
                                    </pre>
                                </CollapsibleSection>

                                {/* Action - Return Type Section */}
                                <CollapsibleSection 
                                    title="Action - Return Type"
                                    isExpanded={expandedSections.action}
                                    onToggle={() => toggleSection('action')}
                                >
                                    <div className="font-mono text-sm text-green-600">
                                        VARCHAR
                                    </div>
                                </CollapsibleSection>

                                {/* Assets Info - Columns Section */}
                                <CollapsibleSection 
                                    title="Assets Info - Columns"
                                    isExpanded={expandedSections.assets}
                                    onToggle={() => toggleSection('assets')}
                                >
                                    <div className="font-mono text-sm space-y-2">
                                        <div>
                                            <span className="text-red-700">"{selectedPolicy.database}.{selectedPolicy.schema}.SUPPORT_TABLE"</span>
                                            <span className="text-gray-600">: [</span>
                                        </div>
                                        <div className="ml-8">
                                            <span className="text-red-700">"TIER"</span>
                                        </div>
                                        <div>
                                            <span className="text-gray-600">]</span>
                                        </div>
                                    </div>
                                </CollapsibleSection>
                            </div>

                            {/* Footer with Okay button */}
                            <div className="sticky bottom-0 bg-white border-t p-4 flex justify-end">
                                <button 
                                    onClick={() => setShowPolicyDrawer(false)}
                                    className="px-6 py-2 bg-blue-600 text-white rounded text-sm hover:bg-blue-700"
                                >
                                    Okay
                                </button>
                            </div>
                        </div>
                    </>
                );
            };

            // Modal
            const CreatePolicyModal = () => {
                if (!showModal) return null;

                return (
                    <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4">
                        <div className="bg-white rounded-lg shadow-2xl max-w-4xl w-full max-h-[90vh] overflow-y-auto">
                            <div className="p-6 border-b">
                                <h2 className="text-xl font-semibold">New Native Policy</h2>
                                <div className="flex items-center gap-4 mt-4">
                                    <div className="flex items-center gap-2">
                                        <div className={`w-8 h-8 ${modalStep === 1 ? 'bg-blue-600 text-white' : 'bg-green-500 text-white'} rounded-full flex items-center justify-center text-sm font-semibold`}>
                                            {modalStep === 2 ? '‚úì' : '1'}
                                        </div>
                                        <span className="text-sm font-medium">Details</span>
                                    </div>
                                    <div className={`flex-1 h-0.5 ${modalStep === 2 ? 'bg-blue-500' : 'bg-gray-300'}`}></div>
                                    <div className="flex items-center gap-2">
                                        <div className={`w-8 h-8 ${modalStep === 2 ? 'bg-blue-600 text-white' : 'bg-gray-300 text-gray-600'} rounded-full flex items-center justify-center text-sm font-semibold`}>
                                            2
                                        </div>
                                        <span className="text-sm">Code</span>
                                    </div>
                                </div>
                            </div>

                            {modalStep === 1 && (
                                <div className="p-6 space-y-4">
                                    <div className={`${selectedPOP?.color} border-2 rounded-lg p-4`}>
                                        <div className="flex items-center gap-2 mb-4">
                                            <span className="text-2xl">{selectedPOP?.icon}</span>
                                            <h3 className="font-semibold">Fill in {selectedPOP?.name} POP Details</h3>
                                        </div>
                                        
                                        <div className="space-y-4">
                                            <div>
                                                <label className="block text-sm font-medium mb-1">
                                                    Vendor Policy Kind <span className="text-red-500">*</span>
                                                </label>
                                                <select 
                                                    value={policyFormData.vendorPolicyKind}
                                                    onChange={(e) => setPolicyFormData({...policyFormData, vendorPolicyKind: e.target.value})}
                                                    className="w-full px-3 py-2 border border-gray-300 rounded text-sm"
                                                >
                                                    <option value="">Select an item</option>
                                                    <option value="MASKING_POLICY">Masking Policy</option>
                                                    <option value="ROW_ACCESS_POLICY">Row Access Policy</option>
                                                </select>
                                            </div>

                                            <div>
                                                <label className="block text-sm font-medium mb-1">
                                                    Vendor Policy Name <span className="text-red-500">*</span>
                                                </label>
                                                <input 
                                                    type="text"
                                                    value={policyFormData.vendorPolicyName}
                                                    onChange={(e) => setPolicyFormData({...policyFormData, vendorPolicyName: e.target.value})}
                                                    placeholder="Enter value"
                                                    className="w-full px-3 py-2 border border-gray-300 rounded text-sm"
                                                />
                                            </div>

                                            <div>
                                                <label className="block text-sm font-medium mb-1">Vendor Policy ID</label>
                                                <input 
                                                    type="text"
                                                    value={policyFormData.vendorPolicyId}
                                                    onChange={(e) => setPolicyFormData({...policyFormData, vendorPolicyId: e.target.value})}
                                                    placeholder="Enter value"
                                                    className="w-full px-3 py-2 border border-gray-300 rounded text-sm"
                                                />
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            )}

                            {modalStep === 2 && (
                                <div className="p-6">
                                    <h3 className="font-semibold mb-4">Write Your Native Policy Code</h3>
                                    <textarea
                                        value={policyCode}
                                        onChange={(e) => setPolicyCode(e.target.value)}
                                        placeholder={`CREATE OR REPLACE MASKING POLICY ${policyFormData.vendorPolicyName || 'your_policy'} AS
    (val STRING) RETURNS STRING ->
    CASE
        WHEN CURRENT_ROLE() = 'ROLE_FINANCE'
            THEN val
        ELSE '***MASKED***'
    END;`}
                                        className="w-full h-96 bg-gray-900 text-green-300 font-mono text-sm p-4 rounded"
                                        style={{ tabSize: 4 }}
                                    />
                                </div>
                            )}

                            <div className="p-6 border-t flex gap-3 justify-end">
                                <button 
                                    onClick={() => {
                                        setShowModal(false);
                                        setShowPolicyDrawer(false);
                                        setCurrentStep(2);
                                    }}
                                    className="px-4 py-2 border border-gray-300 rounded text-sm"
                                >
                                    Cancel
                                </button>
                                {modalStep === 1 && (
                                    <button 
                                        onClick={() => {
                                            setModalStep(2);
                                            setCurrentStep(6);
                                        }}
                                        disabled={!policyFormData.vendorPolicyKind || !policyFormData.vendorPolicyName}
                                        className="px-4 py-2 bg-blue-600 text-white rounded text-sm disabled:bg-gray-300"
                                    >
                                        Continue to Code ‚Üí
                                    </button>
                                )}
                                {modalStep === 2 && (
                                    <div className="flex gap-3">
                                        <button 
                                            onClick={() => setModalStep(1)}
                                            className="px-4 py-2 border border-gray-300 rounded text-sm"
                                        >
                                            ‚Üê Back
                                        </button>
                                        <button 
                                            onClick={() => {
                                                setShowModal(false);
                                                setShowSuccess(true);
                                                setCurrentStep(7);
                                                setTimeout(() => setShowSuccess(false), 3000);
                                            }}
                                            disabled={!policyCode}
                                            className="px-4 py-2 bg-green-600 text-white rounded text-sm disabled:bg-gray-300"
                                        >
                                            Deploy Policy
                                        </button>
                                    </div>
                                )}
                            </div>
                        </div>
                    </div>
                );
            };

            // Policy Details Full Page View (Step 3)
            const PolicyDetailsFullView = () => {
                if (!selectedPolicy) return null;

                return (
                    <div className="ml-64 p-8 pb-32">
                        {showSuccess && (
                            <div className="fixed top-4 right-4 bg-green-500 text-white px-6 py-3 rounded shadow-lg flex items-center gap-2 z-50">
                                <span>‚úì</span>
                                Success - "Snowflake" updated successfully
                            </div>
                        )}

                        <button 
                            onClick={() => {
                                setCurrentView('pop-details');
                                setCurrentStep(2);
                            }}
                            className="text-sm text-blue-600 hover:text-blue-800 mb-6"
                        >
                            ‚Üê Policy 360 Native Policy / Snowflake Auth WS / {selectedPolicy.name}
                        </button>

                        <div className="flex items-center justify-between mb-6">
                            <h1 className="text-2xl font-semibold text-gray-800">{selectedPolicy.name}</h1>
                            <div className="flex items-center gap-3">
                                <div className="text-2xl">{selectedPOP?.icon}</div>
                                <span className="px-3 py-1 bg-green-100 text-green-700 rounded-full text-sm font-medium">
                                    ‚úì Allow
                                </span>
                                <label className="relative inline-flex items-center cursor-pointer">
                                    <input type="checkbox" className="sr-only peer" defaultChecked />
                                    <div className="w-11 h-6 bg-gray-200 peer-focus:ring-4 peer-focus:ring-blue-300 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-blue-600"></div>
                                    <span className="ml-3 text-sm font-medium text-gray-700">Active</span>
                                </label>
                            </div>
                        </div>

                        <div className="bg-white rounded-lg shadow">
                            <div className="border-b flex">
                                <button 
                                    onClick={() => setActiveTab('details')}
                                    className={`px-6 py-3 ${activeTab === 'details' ? 'border-b-2 border-blue-500 text-blue-600' : 'text-gray-600'} font-medium text-sm`}
                                >
                                    Details
                                </button>
                                <button 
                                    onClick={() => setActiveTab('native')}
                                    className={`px-6 py-3 ${activeTab === 'native' ? 'border-b-2 border-blue-500 text-blue-600' : 'text-gray-600'} font-medium text-sm`}
                                >
                                    Native
                                </button>
                                <button 
                                    onClick={() => setActiveTab('audit')}
                                    className={`px-6 py-3 ${activeTab === 'audit' ? 'border-b-2 border-blue-500 text-blue-600' : 'text-gray-600'} font-medium text-sm`}
                                >
                                    Audit
                                </button>
                            </div>

                            <div className="p-6">
                                {activeTab === 'details' && (
                                    <div>
                                        <h3 className="font-semibold mb-4">Policy Details</h3>
                                        <div className="grid grid-cols-2 gap-4">
                                            <div>
                                                <div className="text-sm text-gray-500">Name</div>
                                                <div className="font-medium">{selectedPolicy.name}</div>
                                            </div>
                                            <div>
                                                <div className="text-sm text-gray-500">Policy ID</div>
                                                <div className="font-medium">{selectedPolicy.id.toUpperCase()}</div>
                                            </div>
                                            <div>
                                                <div className="text-sm text-gray-500">Database</div>
                                                <div className="font-medium">{selectedPolicy.database}</div>
                                            </div>
                                            <div>
                                                <div className="text-sm text-gray-500">Schema</div>
                                                <div className="font-medium">{selectedPolicy.schema}</div>
                                            </div>
                                            <div>
                                                <div className="text-sm text-gray-500">Owner</div>
                                                <div className="font-medium">{selectedPolicy.owner}</div>
                                            </div>
                                        </div>
                                    </div>
                                )}

                                {activeTab === 'native' && (
                                    <div>
                                        <div className="flex items-center justify-between mb-4">
                                            <h3 className="font-semibold">Native Code</h3>
                                            <div className="flex gap-2">
                                                <button className="px-4 py-2 border border-gray-300 rounded text-sm">‚úèÔ∏è Edit</button>
                                                {currentStep >= 4 && (
                                                    <button 
                                                        onClick={() => setCurrentStep(5)}
                                                        className="px-4 py-2 bg-green-600 text-white rounded text-sm"
                                                    >
                                                        Create from Native
                                                    </button>
                                                )}
                                            </div>
                                        </div>
                                        
                                        <div className="mb-4">
                                            <div className="text-sm font-medium mb-2">Policy</div>
                                            <pre className="bg-gray-900 text-green-300 p-4 rounded text-xs font-mono overflow-x-auto">
{selectedPolicy.nativeCode}
                                            </pre>
                                        </div>

                                        {selectedPolicy.columns && (
                                            <div>
                                                <div className="text-sm font-medium mb-2">Columns</div>
                                                <pre className="bg-gray-900 text-purple-300 p-4 rounded text-xs font-mono overflow-x-auto">
{selectedPolicy.columns}
                                                </pre>
                                            </div>
                                        )}
                                    </div>
                                )}

                                {activeTab === 'audit' && selectedPolicy.auditEvents && (
                                    <div>
                                        <h3 className="font-semibold mb-4">Audit</h3>
                                        <table className="w-full text-sm">
                                            <thead className="bg-gray-50 border-b">
                                                <tr>
                                                    <th className="px-4 py-2 text-left font-medium text-gray-600">Event ID</th>
                                                    <th className="px-4 py-2 text-left font-medium text-gray-600">Date</th>
                                                    <th className="px-4 py-2 text-left font-medium text-gray-600">User</th>
                                                    <th className="px-4 py-2 text-left font-medium text-gray-600">Operation</th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                {selectedPolicy.auditEvents.map((event, idx) => (
                                                    <tr key={idx} className="border-b">
                                                        <td className="px-4 py-3 text-gray-700">{event.id}</td>
                                                        <td className="px-4 py-3 text-gray-700">{event.date}</td>
                                                        <td className="px-4 py-3 text-gray-700">{event.user}</td>
                                                        <td className="px-4 py-3">
                                                            <span className="px-2 py-1 bg-blue-100 text-blue-700 rounded text-xs">
                                                                {event.operation}
                                                            </span>
                                                        </td>
                                                    </tr>
                                                ))}
                                            </tbody>
                                        </table>
                                    </div>
                                )}
                            </div>
                        </div>
                    </div>
                );
            };

            return (
                <div className="bg-gray-50 min-h-screen">
                    <Sidebar />
                    {currentView === 'orchestration' && <OrchestrationView />}
                    {currentView === 'pop-details' && <POPDetailsView />}
                    {currentView === 'policy-full-view' && <PolicyDetailsFullView />}
                    <PolicyDetailsView />
                    <CreatePolicyModal />
                    <NavigationBar />
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<PlainIDPlatform />);
    </script>
</body>
</html>
